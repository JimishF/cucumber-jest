{"version":3,"sources":["../../src/utils/parseFeature.ts"],"names":["supportCodeLibraryBuilder","finalize","parseFeature","cwd","featurePath","extensions","source","fs","readFileSync","varMapExts","filter","ext","varMapFileName","process","env","CUCUMBER_ENV","path","basename","extname","varMapPaths","resolve","JSON","stringify","encoding","stdout","varMapLocation","parse","varMapFile","require","default","tmpSource","Object","entries","reduce","acc","key","value","replace","RegExp","toString","tmpPath","featureSourcePath","existsSync","mkdirSync","unlinkSync","writeFileSync","parseGherkinExampleTables","examples","example","keys","tableHeader","cells","cell","tableBody","row","i","parseGherkinVariables","text","variable","generateExampleTableSteps","scenario","name","steps","map","step","docString","content","isJson","e","bindGherkinSteps","definitions","definition","find","def","matchesStepName","args","pattern","Array","from","exec","slice","stepArgs","dataTable","DataTable","type","keyword","trim","toLowerCase","last","description","code","given","when","then","parseGherkinSuites","feature","cucumberSupportCode","events","relative","includeSource","includeGherkinDocument","includePickles","newId","document","gherkinDocument","hasBackground","children","background","specs","scenarios","spec","length","suites","afterEach","afterTestCaseHookDefinitions","afterAll","afterTestRunHookDefinitions","beforeEach","beforeTestCaseHookDefinitions","beforeAll","beforeTestRunHookDefinitions","suite","stepDefinitions","execTest","moduleFileExtensions","act","global","fn","options","fileName","world","World","apply","JEST_RETRY_TIMES","jest","retryTimes","forEach","describe","it"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEAA,sCAA0BC,QAA1B;;AAEA,SAASC,YAAT,CAAsBC,GAAtB,EAAmCC,WAAnC,EAAwDC,UAAxD,EAA8E;AAE1E,QAAMC,MAAM,GAAGC,YAAGC,YAAH,CAAgBJ,WAAhB,EAA6B,MAA7B,CAAf;;AAEA,QAAMK,UAAU,GAAGJ,UAAU,CAACK,MAAX,CAAmBC,GAAD,IAASA,GAAG,KAAK,SAAnC,CAAnB;AAEA,QAAMC,cAAc,GAAGC,OAAO,CAACC,GAAR,CAAYC,YAAZ,GAClB,MAAKC,cAAKC,QAAL,CAAcb,WAAd,EAA2BY,cAAKE,OAAL,CAAad,WAAb,CAA3B,CAAsD,IAAGS,OAAO,CAACC,GAAR,CAAYC,YAAa,OADrE,GAElB,MAAKC,cAAKC,QAAL,CAAcb,WAAd,EAA2BY,cAAKE,OAAL,CAAad,WAAb,CAA3B,CAAsD,OAFhE,CAN0E,CAU1E;AACA;;AACA,QAAMe,WAAW,GAAG,8BAChB,MADgB,EAEhB,CACIH,cAAKI,OAAL,CAAaP,OAAO,CAACV,GAAR,EAAb,EAA4B,+CAA5B,CADJ,EAEIA,GAFJ,EAGIS,cAHJ,EAIIS,IAAI,CAACC,SAAL,CAAeb,UAAf,CAJJ,CAFgB,EAQhB;AACIc,IAAAA,QAAQ,EAAE;AADd,GARgB,EAWlBC,MAXF;AAaA,QAAMC,cAAc,GAAGJ,IAAI,CAACK,KAAL,CAAWP,WAAX,EAAwB,CAAxB,CAAvB,CAzB0E,CA2B1E;;AACA,QAAMQ,UAAU,GAAGF,cAAc,GAC7B,qCAAsBG,OAAO,CAACH,cAAD,CAA7B,EAA+CI,OADlB,GAE7B,IAFJ,CA5B0E,CAgC1E;;AACA,QAAMC,SAAS,GAAGH,UAAU,GACxBI,MAAM,CAACC,OAAP,CAAeL,UAAf,EAA2BM,MAA3B,CAAkC,CAACC,GAAD,EAAM,CAACC,GAAD,EAAMC,KAAN,CAAN,KAC9BF,GAAG,CAACG,OAAJ,CAAY,IAAIC,MAAJ,CAAW,QAAQH,GAAnB,EAAwB,GAAxB,CAAZ,EAA0CC,KAAK,CAACG,QAAN,EAA1C,CADJ,EAEGjC,MAAM,GAAG,EAFZ,CADwB,GAIxBA,MAJJ;;AAMA,QAAMkC,OAAO,GAAGxB,cAAKI,OAAL,CAAajB,GAAb,EAAkB,qBAAlB,CAAhB;;AAEA,QAAMsC,iBAAiB,GAAGX,SAAS,KAAKxB,MAAd,GACtBU,cAAKI,OAAL,CAAaoB,OAAb,EAAsBxB,cAAKC,QAAL,CAAcb,WAAd,CAAtB,CADsB,GAEtBA,WAFJ;;AAIA,MAAI0B,SAAS,KAAKxB,MAAlB,EAA0B;AAEtB,QAAI,CAACC,YAAGmC,UAAH,CAAcF,OAAd,CAAL,EAA6B;AACzBjC,kBAAGoC,SAAH,CAAaH,OAAb;AACH;;AAED,QAAIjC,YAAGmC,UAAH,CAAcD,iBAAd,CAAJ,EAAsC;AAClClC,kBAAGqC,UAAH,CAAcH,iBAAd;AACH,KARqB,CAUtB;;;AACAlC,gBAAGsC,aAAH,CAAiBJ,iBAAjB,EAAoCX,SAApC;;AAEA,WAAOW,iBAAP;AACH;;AAED,SAAOrC,WAAP;AACH;;AAED,SAAS0C,yBAAT,CAAmCC,QAAnC,EAA6C;AACzC,SAAO,CAACA,QAAQ,IAAI,EAAb,EACFd,MADE,CACK,CAACC,GAAD,EAAMc,OAAN,KAAkB;AAEtB,UAAMC,IAAI,GAAGD,OAAO,CAACE,WAAR,CAAoBC,KAApB,CACRlB,MADQ,CACD,CAACC,GAAD,EAAMkB,IAAN,KAAgB,CAAC,GAAGlB,GAAJ,EAASkB,IAAI,CAAChB,KAAd,CADf,EACsC,EADtC,CAAb;AAGA,WAAO,CACH,GAAGF,GADA,EAEH,GAAGc,OAAO,CAACK,SAAR,CACEpB,MADF,CACS,CAACC,GAAD,EAAMoB,GAAN,KAAe,CACnB,GAAGpB,GADgB,EAEnBe,IAAI,CAAChB,MAAL,CAAY,CAACC,GAAD,EAAMC,GAAN,EAAWoB,CAAX,KAAkB,CAC1B,GAAGrB,GADuB,EAE1B;AACIC,MAAAA,GADJ;AAEIC,MAAAA,KAAK,EAAEkB,GAAG,CAACH,KAAJ,CAAUI,CAAV,EAAanB;AAFxB,KAF0B,CAA9B,EAMI,EANJ,CAFmB,CADxB,EAUK,EAVL,CAFA,CAAP;AAcH,GApBE,EAoBA,EApBA,CAAP;AAqBH;;AAED,SAASoB,qBAAT,CAA+BR,OAA/B,EAAwCS,IAAxC,EAA8C;AAC1C,SAAOT,OAAO,CAACf,MAAR,CAAe,CAACC,GAAD,EAAMwB,QAAN,KAAmB;AACrC,WAAOxB,GAAG,CAACG,OAAJ,CAAY,IAAIC,MAAJ,CAAY,IAAGoB,QAAQ,CAACvB,GAAI,GAA5B,CAAZ,EAA6CuB,QAAQ,CAACtB,KAAtD,CAAP;AACH,GAFM,EAEJqB,IAAI,GAAG,EAFH,CAAP;AAGH;;AAED,SAASE,yBAAT,CAAmCZ,QAAnC,EAA6Ca,QAA7C,EAAuD;AACnD,SAAOb,QAAQ,CAACd,MAAT,CAAgB,CAACC,GAAD,EAAMc,OAAN,KAAmB,CACtC,GAAGd,GADmC,EAEtC,EACI,GAAG0B,QADP;AAEIC,IAAAA,IAAI,EAAEL,qBAAqB,CAACR,OAAD,EAAUY,QAAQ,CAACC,IAAnB,CAF/B;AAGIC,IAAAA,KAAK,EAAEF,QAAQ,CAACE,KAAT,CAAeC,GAAf,CAAoBC,IAAD,KAAW,EACjC,GAAGA,IAD8B;AAEjC,UAAGA,IAAI,CAACC,SAAL,GAAiB;AAChBA,QAAAA,SAAS,EAAE,EACP,GAAGD,IAAI,CAACC,SADD;AAEPC,UAAAA,OAAO,EAAEV,qBAAqB,CAACR,OAAD,EAAUgB,IAAI,CAACC,SAAL,CAAeC,OAAzB;AAFvB;AADK,OAAjB,GAKC,EALJ,CAFiC;AAQjCT,MAAAA,IAAI,EAAED,qBAAqB,CAACR,OAAD,EAAUgB,IAAI,CAACP,IAAf;AARM,KAAX,CAAnB;AAHX,GAFsC,CAAnC,EAgBH,EAhBG,CAAP;AAiBH;;AAED,SAASU,MAAT,CAAgBV,IAAhB,EAA+B;AAC3B,MAAI;AACApC,IAAAA,IAAI,CAACK,KAAL,CAAW+B,IAAX;AACA,WAAO,IAAP;AACH,GAHD,CAGE,OAAOW,CAAP,EAAU;AACR,WAAO,KAAP;AACH;AACJ;;AAED,SAASC,gBAAT,CAA0BP,KAA1B,EAAiCQ,WAAjC,EAA8C;AAE1C,SAAOR,KAAK,CAAC7B,MAAN,CAAa,CAACC,GAAD,EAAM8B,IAAN,KAAe;AAE/B,UAAMO,UAAU,GAAGD,WAAW,CAACE,IAAZ,CAAkBC,GAAD,IAAS;AACzC,aAAOA,GAAG,CAACC,eAAJ,CAAoBV,IAAI,CAACP,IAAzB,CAAP;AACH,KAFkB,CAAnB;AAIA,UAAMkB,IAAI,GAAGJ,UAAU,CAACK,OAAX,GACTC,KAAK,CAACC,IAAN,CAAWP,UAAU,CAACK,OAAX,CAAmBG,IAAnB,CAAwBf,IAAI,CAACP,IAA7B,CAAX,EAA+CuB,KAA/C,CAAqD,CAArD,CADS,GAET,EAFJ;AAIA,UAAMC,QAAQ,GAAG,CACb,GAAGN,IADU,EAEb,IAAGX,IAAI,CAACkB,SAAL,GACC,CAAC,IAAIC,mBAAJ,CAAcnB,IAAI,CAACkB,SAAnB,CAAD,CADD,GAEC,EAFJ,CAFa,EAKb,IAAGlB,IAAI,CAACC,SAAL,GACC,CAACE,MAAM,CAACH,IAAI,CAACC,SAAL,CAAeC,OAAhB,CAAN,GAAiC7C,IAAI,CAACK,KAAL,CAAWsC,IAAI,CAACC,SAAL,CAAeC,OAA1B,CAAjC,GAAsEF,IAAI,CAACC,SAAL,CAAeC,OAAtF,CADD,GAEC,EAFJ,CALa,CAAjB;AAUA,UAAMkB,IAAI,GAAG,CAACpB,IAAI,CAACqB,OAAL,IAAgB,EAAjB,EAAqBC,IAArB,GAA4BC,WAA5B,EAAb;;AAEA,QAAIrD,GAAG,CAACsD,IAAJ,KAAaJ,IAAb,IAAqBA,IAAI,KAAK,KAA9B,IAAuCA,IAAI,KAAK,KAApD,EAA2D;AACvDlD,MAAAA,GAAG,CAACsD,IAAJ,GAAWJ,IAAX;AACH;;AAED,WAAO,EACH,GAAGlD,GADA;AAEH,OAACA,GAAG,CAACsD,IAAL,GAAY,CACR,IAAGtD,GAAG,CAACA,GAAG,CAACsD,IAAL,CAAH,IAAiB,EAApB,CADQ,EAER;AACIC,QAAAA,WAAW,EAAG,GAAEzB,IAAI,CAACqB,OAAQ,GAAErB,IAAI,CAACP,IAAK,EAD7C;AAEI,WAAGO,IAFP;AAGI0B,QAAAA,IAAI,EAAEnB,UAAU,CAACmB,IAHrB;AAIIT,QAAAA;AAJJ,OAFQ;AAFT,KAAP;AAYH,GAtCM,EAsCJ;AACCO,IAAAA,IAAI,EAAE,OADP;AAECG,IAAAA,KAAK,EAAE,EAFR;AAGCC,IAAAA,IAAI,EAAE,EAHP;AAICC,IAAAA,IAAI,EAAE;AAJP,GAtCI,CAAP;AA4CH;;AAED,SAASC,kBAAT,CAA4B3F,GAA5B,EAAiC4F,OAAjC,EAAkD1F,UAAlD,EAAwE2F,mBAAxE,EAAkG;AAE9F,QAAM5F,WAAW,GAAGF,YAAY,CAACC,GAAD,EAAM4F,OAAN,EAAe1F,UAAf,CAAhC;;AAEA,QAAMC,MAAM,GAAGC,YAAGC,YAAH,CAAgBJ,WAAhB,EAA6B,MAA7B,CAAf;;AAEA,QAAM6F,MAAM,GAAG,+BAAiB3F,MAAjB,EAAyBU,cAAKkF,QAAL,CAAc/F,GAAd,EAAmBC,WAAnB,CAAzB,EAA0D;AACrE+F,IAAAA,aAAa,EAAE,KADsD;AAErEC,IAAAA,sBAAsB,EAAE,IAF6C;AAGrEC,IAAAA,cAAc,EAAE,IAHqD;AAIrEC,IAAAA,KAAK,EAAE;AAJ8D,GAA1D,CAAf;AAOA,QAAMC,QAAQ,GAAGN,MAAM,CAAC,CAAD,CAAN,CAAUO,eAAV,CAA0BT,OAA3C;AACA,QAAMU,aAAa,GAAG,CAAC,CAACF,QAAQ,CAACG,QAAT,CAAkB,CAAlB,EAAqBC,UAA7C;AACA,QAAMC,KAAK,GAAGH,aAAa,GAAGF,QAAQ,CAACG,QAAT,CAAkB1B,KAAlB,CAAwB,CAAxB,CAAH,GAAgCuB,QAAQ,CAACG,QAApE;AAEA,QAAMG,SAAS,GAAGD,KAAK,CAAC3E,MAAN,CAAa,CAACC,GAAD,EAAM4E,IAAN,KAAe;AAE1C,UAAM/D,QAAQ,GAAGD,yBAAyB,CAACgE,IAAI,CAAClD,QAAL,CAAcb,QAAf,CAA1C;AAEA,WAAO,CACH,GAAGb,GADA,EAEH,IAAGa,QAAQ,CAACgE,MAAT,GACCpD,yBAAyB,CAACZ,QAAD,EAAW+D,IAAI,CAAClD,QAAhB,CAD1B,GAEC,CACI,EACI,GAAGkD,IAAI,CAAClD,QADZ;AAEIE,MAAAA,KAAK,EAAEgD,IAAI,CAAClD,QAAL,CAAcE;AAFzB,KADJ,CAFJ,CAFG,CAAP;AAWH,GAfiB,EAef,EAfe,CAAlB;AAiBA,QAAMkD,MAAM,GAAGH,SAAS,CAAC9C,GAAV,CAAeH,QAAD,KAAe,EACxC,GAAGA,QADqC;AAExC5C,IAAAA,IAAI,EAAEZ,WAFkC;AAGxC0D,IAAAA,KAAK,EAAE,CACH,IAAG2C,aAAa,GAAGF,QAAQ,CAACG,QAAT,CAAkB,CAAlB,EAAqBC,UAArB,CAAgC7C,KAAnC,GAA2C,EAA3D,CADG,EAEH,GAAGF,QAAQ,CAACE,KAFT;AAHiC,GAAf,CAAd,CAAf;AASA,SAAO;AACHyC,IAAAA,QADG;AAEHU,IAAAA,SAAS,EAAEjB,mBAAmB,CAACkB,4BAF5B;AAGHC,IAAAA,QAAQ,EAAEnB,mBAAmB,CAACoB,2BAH3B;AAIHC,IAAAA,UAAU,EAAErB,mBAAmB,CAACsB,6BAJ7B;AAKHC,IAAAA,SAAS,EAAEvB,mBAAmB,CAACwB,4BAL5B;AAMHR,IAAAA,MAAM,EAAEA,MAAM,CAACjD,GAAP,CAAY0D,KAAD,KAAY,EAC3B,GAAGA,KADwB;AAE3B3D,MAAAA,KAAK,EAAEO,gBAAgB,CACnBoD,KAAK,CAAC3D,KADa,EAEnBkC,mBAAmB,CAAC0B,eAFD;AAFI,KAAZ,CAAX;AANL,GAAP;AAcH;;AAEc,SAASC,QAAT,CAAkBxH,GAAlB,EAA+BC,WAA/B,EAAoDwH,oBAApD,EAAoF;AAE/F,QAAMC,GAAG,GAAG,OAAOC,MAAM,CAAC,QAAD,CAAb,KAA4B,WAA5B,GACR,MAAOC,EAAP,IAAc,MAAMA,EAAE,EADd,GAERnG,OAAO,CAAC,sBAAD,CAAP,CAAgCiG,GAFpC,CAF+F,CAM/F;AACA;;AACA,QAAMf,IAAI,GAAGhB,kBAAkB,CAC3B3F,GAD2B,EAE3BC,WAF2B,EAG3BwH,oBAH2B,EAI3B5H,sCAA0BgI,OAJC,CAA/B;;AAOA,QAAMC,QAAQ,GAAGjH,cAAKC,QAAL,CAAcb,WAAd,EAA2BY,cAAKE,OAAL,CAAad,WAAb,CAA3B,CAAjB;;AAEA,MAAI8H,KAAJ;AAEAX,EAAAA,SAAS,CAAC,YAAY;AAElBW,IAAAA,KAAK,GAAG,IAAIlI,sCAA0BgI,OAA1B,CAAkCG,KAAtC,CAA4C,EAA5C,CAAR;;AAEA,SAAK,IAAI5E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuD,IAAI,CAACS,SAAL,CAAeR,MAAnC,EAA2CxD,CAAC,EAA5C,EAAgD;AAC5C,YAAMsE,GAAG,CAAC,YAAY;AAClB,cAAMf,IAAI,CAACS,SAAL,CAAehE,CAAf,EAAkBmC,IAAlB,CAAuB0C,KAAvB,CAA6BF,KAA7B,EAAoC,CAACpB,IAAD,EAAOmB,QAAP,CAApC,CAAN;AACH,OAFQ,CAAT;AAGH;AACJ,GATQ,CAAT;AAWAd,EAAAA,QAAQ,CAAC,YAAY;AAEjB,SAAK,IAAI5D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuD,IAAI,CAACK,QAAL,CAAcJ,MAAlC,EAA0CxD,CAAC,EAA3C,EAA+C;AAC3C,YAAMsE,GAAG,CAAC,YAAY;AAClB,cAAMf,IAAI,CAACK,QAAL,CAAc5D,CAAd,EAAiBmC,IAAjB,CAAsB0C,KAAtB,CAA4BF,KAA5B,EAAmC,CAACpB,IAAD,EAAOmB,QAAP,CAAnC,CAAN;AACH,OAFQ,CAAT;AAGH;;AAEDC,IAAAA,KAAK,GAAG,IAAR;AACH,GATO,CAAR;;AAWA,MAAIrH,OAAO,CAACC,GAAR,CAAYuH,gBAAhB,EAAkC;AAC9BC,IAAAA,IAAI,CAACC,UAAL,CAAgB,CAAC1H,OAAO,CAACC,GAAR,CAAYuH,gBAA7B;AACH;;AAEDvB,EAAAA,IAAI,CAACE,MAAL,CAAYwB,OAAZ,CAAqBf,KAAD,IAAW;AAE3BgB,IAAAA,QAAQ,CAAC3B,IAAI,CAACP,QAAL,CAAclB,OAAd,GAAwB,IAAxB,GAA+ByB,IAAI,CAACP,QAAL,CAAc1C,IAA7C,GAAoD,KAApD,GAA4D4D,KAAK,CAAC5D,IAAnE,EAAyE,MAAM;AAEnF0D,MAAAA,SAAS,CAAC,YAAY;AAClB,aAAK,IAAIhE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuD,IAAI,CAACO,UAAL,CAAgBN,MAApC,EAA4CxD,CAAC,EAA7C,EAAiD;AAC7C,gBAAMsE,GAAG,CAAC,YAAY;AAClB,kBAAMf,IAAI,CAACO,UAAL,CAAgB9D,CAAhB,EAAmBmC,IAAnB,CAAwB0C,KAAxB,CAA8BF,KAA9B,EAAqC,CAAC;AAACpB,cAAAA,IAAD;AAAOW,cAAAA,KAAK,EAAEA;AAAd,aAAD,EAAuBQ,QAAvB,CAArC,CAAN;AACH,WAFQ,CAAT;AAGH;AACJ,OANQ,CAAT;AAQAd,MAAAA,QAAQ,CAAC,YAAY;AACjB,aAAK,IAAI5D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuD,IAAI,CAACG,SAAL,CAAeF,MAAnC,EAA2CxD,CAAC,EAA5C,EAAgD;AAC5C,gBAAMsE,GAAG,CAAC,YAAY;AAClB,kBAAMf,IAAI,CAACG,SAAL,CAAe1D,CAAf,EAAkBmC,IAAlB,CAAuB0C,KAAvB,CAA6BF,KAA7B,EAAoC,CAAC;AAACpB,cAAAA,IAAD;AAAOW,cAAAA,KAAK,EAAEA;AAAd,aAAD,EAAuBQ,QAAvB,CAApC,CAAN;AACH,WAFQ,CAAT;AAGH;AACJ,OANO,CAAR;;AAQA,WAAK,IAAI1E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkE,KAAK,CAAC3D,KAAN,CAAY6B,KAAZ,CAAkBoB,MAAtC,EAA8CxD,CAAC,EAA/C,EAAmD;AAC/CmF,QAAAA,EAAE,CAACjB,KAAK,CAAC3D,KAAN,CAAY6B,KAAZ,CAAkBpC,CAAlB,EAAqB8B,OAArB,GAA+BoC,KAAK,CAAC3D,KAAN,CAAY6B,KAAZ,CAAkBpC,CAAlB,EAAqBE,IAArD,EAA2D,YAAY;AACrE,gBAAMgE,KAAK,CAAC3D,KAAN,CAAY6B,KAAZ,CAAkBpC,CAAlB,EAAqBmC,IAArB,CAA0B0C,KAA1B,CAAgCF,KAAhC,EAAuCT,KAAK,CAAC3D,KAAN,CAAY6B,KAAZ,CAAkBpC,CAAlB,EAAqB0B,QAA5D,CAAN;AACH,SAFC,CAAF;AAGH;;AAED,WAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkE,KAAK,CAAC3D,KAAN,CAAY8B,IAAZ,CAAiBmB,MAArC,EAA6CxD,CAAC,EAA9C,EAAkD;AAC9CmF,QAAAA,EAAE,CAACjB,KAAK,CAAC3D,KAAN,CAAY8B,IAAZ,CAAiBrC,CAAjB,EAAoB8B,OAApB,GAA8BoC,KAAK,CAAC3D,KAAN,CAAY8B,IAAZ,CAAiBrC,CAAjB,EAAoBE,IAAnD,EAAyD,YAAY;AACnE,gBAAMgE,KAAK,CAAC3D,KAAN,CAAY8B,IAAZ,CAAiBrC,CAAjB,EAAoBmC,IAApB,CAAyB0C,KAAzB,CAA+BF,KAA/B,EAAsCT,KAAK,CAAC3D,KAAN,CAAY8B,IAAZ,CAAiBrC,CAAjB,EAAoB0B,QAA1D,CAAN;AACH,SAFC,CAAF;AAGH;;AAED,WAAK,IAAI1B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkE,KAAK,CAAC3D,KAAN,CAAY+B,IAAZ,CAAiBkB,MAArC,EAA6CxD,CAAC,EAA9C,EAAkD;AAC9CmF,QAAAA,EAAE,CAACjB,KAAK,CAAC3D,KAAN,CAAY+B,IAAZ,CAAiBtC,CAAjB,EAAoB8B,OAApB,GAA8BoC,KAAK,CAAC3D,KAAN,CAAY+B,IAAZ,CAAiBtC,CAAjB,EAAoBE,IAAnD,EAAyD,YAAY;AACnE,gBAAMgE,KAAK,CAAC3D,KAAN,CAAY+B,IAAZ,CAAiBtC,CAAjB,EAAoBmC,IAApB,CAAyB0C,KAAzB,CAA+BF,KAA/B,EAAsCT,KAAK,CAAC3D,KAAN,CAAY+B,IAAZ,CAAiBtC,CAAjB,EAAoB0B,QAA1D,CAAN;AACH,SAFC,CAAF;AAGH;AACJ,KAnCO,CAAR;AAoCH,GAtCD;AAwCH","sourcesContent":["import generateMessages from '@cucumber/gherkin/dist/src/stream/generateMessages';\nimport { uuid } from '@cucumber/messages/dist/src/IdGenerator';\nimport { spawnSync } from 'child_process';\nimport DataTable from 'cucumber/lib/models/data_table';\nimport { default as supportCodeLibraryBuilder } from 'cucumber/lib/support_code_library_builder';\nimport { interopRequireDefault } from 'jest-util';\nimport fs from 'fs';\nimport path from 'path';\n\nsupportCodeLibraryBuilder.finalize();\n\nfunction parseFeature(cwd: string, featurePath: string, extensions: string[]) {\n\n    const source = fs.readFileSync(featurePath, 'utf8');\n\n    const varMapExts = extensions.filter((ext) => ext !== 'feature');\n\n    const varMapFileName = process.env.CUCUMBER_ENV ?\n        `**/${path.basename(featurePath, path.extname(featurePath))}.${process.env.CUCUMBER_ENV}.vars` :\n        `**/${path.basename(featurePath, path.extname(featurePath))}.vars`;\n\n    // scan relative directories to find any file that matches the feature file name,\n    // but as another extension\n    const varMapPaths = spawnSync(\n        'node',\n        [\n            path.resolve(process.cwd(), './node_modules/cucumber-jest/dist/getPaths.js'),\n            cwd,\n            varMapFileName,\n            JSON.stringify(varMapExts)\n        ],\n        {\n            encoding: 'utf-8'\n        }\n    ).stdout;\n\n    const varMapLocation = JSON.parse(varMapPaths)[0];\n\n    // load the var map file\n    const varMapFile = varMapLocation ?\n        interopRequireDefault(require(varMapLocation)).default as { [name: string]: string | boolean | Date | number } :\n        null;\n\n    // interpolate the feature file with the varMapFile\n    const tmpSource = varMapFile ?\n        Object.entries(varMapFile).reduce((acc, [key, value]) => (\n            acc.replace(new RegExp('\\\\$' + key, 'g'), value.toString())\n        ), source + '') :\n        source;\n\n    const tmpPath = path.resolve(cwd, './node_modules/.tmp');\n\n    const featureSourcePath = tmpSource !== source ?\n        path.resolve(tmpPath, path.basename(featurePath)) :\n        featurePath;\n\n    if (tmpSource !== source) {\n\n        if (!fs.existsSync(tmpPath)) {\n            fs.mkdirSync(tmpPath);\n        }\n\n        if (fs.existsSync(featureSourcePath)) {\n            fs.unlinkSync(featureSourcePath);\n        }\n\n        // write the temp feature file to tmp directory\n        fs.writeFileSync(featureSourcePath, tmpSource);\n\n        return featureSourcePath;\n    }\n\n    return featurePath;\n}\n\nfunction parseGherkinExampleTables(examples) {\n    return (examples || [])\n        .reduce((acc, example) => {\n\n            const keys = example.tableHeader.cells\n                .reduce((acc, cell) => ([...acc, cell.value]), []);\n\n            return [\n                ...acc,\n                ...example.tableBody\n                    .reduce((acc, row) => ([\n                        ...acc,\n                        keys.reduce((acc, key, i) => ([\n                            ...acc,\n                            {\n                                key,\n                                value: row.cells[i].value\n                            }\n                        ]), [])\n                    ]), [])\n            ];\n        }, []);\n}\n\nfunction parseGherkinVariables(example, text) {\n    return example.reduce((acc, variable) => {\n        return acc.replace(new RegExp(`<${variable.key}>`), variable.value);\n    }, text + '');\n}\n\nfunction generateExampleTableSteps(examples, scenario) {\n    return examples.reduce((acc, example) => ([\n        ...acc,\n        {\n            ...scenario,\n            name: parseGherkinVariables(example, scenario.name),\n            steps: scenario.steps.map((step) => ({\n                ...step,\n                ...step.docString ? {\n                    docString: {\n                        ...step.docString,\n                        content: parseGherkinVariables(example, step.docString.content)\n                    }\n                } : {},\n                text: parseGherkinVariables(example, step.text)\n            }))\n        }\n    ]), []);\n}\n\nfunction isJson(text): boolean {\n    try {\n        JSON.parse(text);\n        return true;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction bindGherkinSteps(steps, definitions) {\n\n    return steps.reduce((acc, step) => {\n\n        const definition = definitions.find((def) => {\n            return def.matchesStepName(step.text);\n        });\n\n        const args = definition.pattern ?\n            Array.from(definition.pattern.exec(step.text)).slice(1) :\n            [];\n\n        const stepArgs = [\n            ...args,\n            ...step.dataTable ?\n                [new DataTable(step.dataTable)] :\n                [],\n            ...step.docString ?\n                [isJson(step.docString.content) ? JSON.parse(step.docString.content) : step.docString.content] :\n                []\n        ];\n\n        const type = (step.keyword || '').trim().toLowerCase();\n\n        if (acc.last !== type && type !== 'and' && type !== 'but') {\n            acc.last = type;\n        }\n\n        return {\n            ...acc,\n            [acc.last]: [\n                ...acc[acc.last] || [],\n                {\n                    description: `${step.keyword}${step.text}`,\n                    ...step,\n                    code: definition.code,\n                    stepArgs\n                }\n            ]\n        };\n    }, {\n        last: 'given',\n        given: [],\n        when: [],\n        then: []\n    });\n}\n\nfunction parseGherkinSuites(cwd, feature: string, extensions: string[], cucumberSupportCode: any) {\n\n    const featurePath = parseFeature(cwd, feature, extensions);\n\n    const source = fs.readFileSync(featurePath, 'utf8');\n\n    const events = generateMessages(source, path.relative(cwd, featurePath), {\n        includeSource: false,\n        includeGherkinDocument: true,\n        includePickles: true,\n        newId: uuid()\n    });\n\n    const document = events[0].gherkinDocument.feature;\n    const hasBackground = !!document.children[0].background;\n    const specs = hasBackground ? document.children.slice(1) : document.children;\n\n    const scenarios = specs.reduce((acc, spec) => {\n\n        const examples = parseGherkinExampleTables(spec.scenario.examples);\n\n        return [\n            ...acc,\n            ...examples.length ?\n                generateExampleTableSteps(examples, spec.scenario) :\n                [\n                    {\n                        ...spec.scenario,\n                        steps: spec.scenario.steps\n                    }\n                ]\n        ];\n    }, []);\n\n    const suites = scenarios.map((scenario) => ({\n        ...scenario,\n        path: featurePath,\n        steps: [\n            ...hasBackground ? document.children[0].background.steps : [],\n            ...scenario.steps\n        ]\n    }));\n\n    return {\n        document,\n        afterEach: cucumberSupportCode.afterTestCaseHookDefinitions,\n        afterAll: cucumberSupportCode.afterTestRunHookDefinitions,\n        beforeEach: cucumberSupportCode.beforeTestCaseHookDefinitions,\n        beforeAll: cucumberSupportCode.beforeTestRunHookDefinitions,\n        suites: suites.map((suite) => ({\n            ...suite,\n            steps: bindGherkinSteps(\n                suite.steps,\n                cucumberSupportCode.stepDefinitions\n            )\n        }))\n    };\n}\n\nexport default function execTest(cwd: string, featurePath: string, moduleFileExtensions: string[]) {\n\n    const act = typeof global['window'] === 'undefined' ?\n        async (fn) => await fn() :\n        require('react-dom/test-utils').act;\n\n    // parse the feature file with given cucumber steps / hooks\n    // generating a jasmine-like structure\n    const spec = parseGherkinSuites(\n        cwd,\n        featurePath,\n        moduleFileExtensions,\n        supportCodeLibraryBuilder.options\n    );\n\n    const fileName = path.basename(featurePath, path.extname(featurePath));\n\n    let world;\n\n    beforeAll(async () => {\n\n        world = new supportCodeLibraryBuilder.options.World({});\n\n        for (let i = 0; i < spec.beforeAll.length; i++) {\n            await act(async () => {\n                await spec.beforeAll[i].code.apply(world, [spec, fileName]);\n            });\n        }\n    });\n\n    afterAll(async () => {\n\n        for (let i = 0; i < spec.afterAll.length; i++) {\n            await act(async () => {\n                await spec.afterAll[i].code.apply(world, [spec, fileName]);\n            });\n        }\n\n        world = null;\n    });\n\n    if (process.env.JEST_RETRY_TIMES) {\n        jest.retryTimes(+process.env.JEST_RETRY_TIMES);\n    }\n\n    spec.suites.forEach((suite) => {\n\n        describe(spec.document.keyword + ': ' + spec.document.name + ' - ' + suite.name, () => {\n\n            beforeAll(async () => {\n                for (let i = 0; i < spec.beforeEach.length; i++) {\n                    await act(async () => {\n                        await spec.beforeEach[i].code.apply(world, [{spec, suite: suite}, fileName]);\n                    });\n                }\n            });\n\n            afterAll(async () => {\n                for (let i = 0; i < spec.afterEach.length; i++) {\n                    await act(async () => {\n                        await spec.afterEach[i].code.apply(world, [{spec, suite: suite}, fileName]);\n                    });\n                }\n            });\n\n            for (let i = 0; i < suite.steps.given.length; i++) {\n                it(suite.steps.given[i].keyword + suite.steps.given[i].text, async () => {\n                    await suite.steps.given[i].code.apply(world, suite.steps.given[i].stepArgs);\n                });\n            }\n\n            for (let i = 0; i < suite.steps.when.length; i++) {\n                it(suite.steps.when[i].keyword + suite.steps.when[i].text, async () => {\n                    await suite.steps.when[i].code.apply(world, suite.steps.when[i].stepArgs);\n                });\n            }\n\n            for (let i = 0; i < suite.steps.then.length; i++) {\n                it(suite.steps.then[i].keyword + suite.steps.then[i].text, async () => {\n                    await suite.steps.then[i].code.apply(world, suite.steps.then[i].stepArgs);\n                });\n            }\n        });\n    });\n\n}\n"],"file":"parseFeature.js"}